<div class="card border-secondary">
  <div class="card-header d-flex align-items-center justify-content-between">
    <div class="d-flex align-items-center">
      <i class="bi bi-database me-2"></i>
      <strong>Database</strong>
      <span class="text-secondary ms-2 small">(server-selected)</span>
    </div>

    <button class="btn btn-sm btn-outline-secondary" (click)="refreshAll()">
      <i class="bi bi-arrow-clockwise me-1"></i> Refresh
    </button>
  </div>

  <div class="card-body">
    <div class="row g-2 align-items-end">
      <div class="col-12 col-lg-3">
        <div class="small text-secondary">Active mode</div>
        <div>
          <span class="badge text-bg-dark text-uppercase">{{ status?.mode || 'unknown' }}</span>
        </div>
      </div>

      <div class="col-12 col-lg-9">
        <div class="small text-secondary">Selected path</div>
        <div class="d-flex align-items-center">
          <code class="flex-grow-1 text-break">{{ status?.selectedPath || '(none)' }}</code>
          <span class="badge ms-2" [ngClass]="status?.selectedExists ? 'text-bg-success' : 'text-bg-danger'">
            {{ status?.selectedExists ? 'FOUND' : 'MISSING' }}
          </span>
        </div>
      </div>
    </div>

    <div *ngIf="loadingStatus" class="mt-3 text-secondary">
      <i class="bi bi-hourglass-split me-2"></i> Checking DB status...
    </div>

    <div *ngIf="error" class="alert alert-danger mt-3 mb-0">
      <i class="bi bi-exclamation-triangle me-2"></i>{{ error }}
    </div>

    <div *ngIf="status && !status.selectedExists" class="alert alert-warning mt-3 mb-0">
      <div class="d-flex align-items-start">
        <i class="bi bi-info-circle me-2 mt-1"></i>
        <div>
          <div><strong>DB file not found.</strong></div>
          <div class="small text-secondary mt-1">
            DB navigation is disabled until the file exists at the selected path.
          </div>
          <hr class="my-2" />
          <div class="small">
            <div class="text-secondary">Known paths:</div>
            <div><code>{{ status.knownPaths.debug }}</code></div>
            <div><code>{{ status.knownPaths.release }}</code></div>
            <div class="text-secondary mt-2">
              Switch mode on the server using <code>NGDOCS_DB_MODE</code>.
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="status?.selectedExists" class="mt-3">
      <div class="row g-3">
        <div class="col-12 col-lg-4">
          <div class="border rounded p-2">
            <div class="d-flex align-items-center justify-content-between mb-2">
              <div class="small text-secondary">
                <i class="bi bi-table me-1"></i> Tables
              </div>
              <span class="badge text-bg-secondary">{{ tablesResp?.tables?.length || 0 }}</span>
            </div>

            <div *ngIf="loadingTables" class="text-secondary small">
              <i class="bi bi-hourglass-split me-2"></i> Loading tables...
            </div>

            <div class="list-group list-group-flush" style="max-height: 280px; overflow: auto;">
              <button
                *ngFor="let t of tablesResp?.tables"
                type="button"
                class="list-group-item list-group-item-action"
                [class.active]="t === selectedTable"
                (click)="selectTable(t)"
              >
                <i class="bi bi-grid-3x3-gap me-2"></i>{{ t }}
              </button>
            </div>
          </div>
        </div>

        <div class="col-12 col-lg-8">
          <div class="border rounded p-2">
            <div class="d-flex align-items-center justify-content-between mb-2">
              <div class="small text-secondary">
                <i class="bi bi-eye me-1"></i> Preview
              </div>
              <div class="small text-secondary">
                <span *ngIf="tableResp?.primaryKey">PK: <code>{{ tableResp?.primaryKey }}</code></span>
              </div>
            </div>

            <div *ngIf="!selectedTable" class="text-secondary small">
              Pick a table on the left to preview rows.
            </div>

            <div *ngIf="loadingTable" class="text-secondary small">
              <i class="bi bi-hourglass-split me-2"></i> Loading table data...
            </div>

            <div *ngIf="tableResp && !loadingTable">
              <div class="small text-secondary mb-2">
                Rows: {{ tableResp.paging.total }} (showing up to {{ tableResp.paging.limit }})
              </div>

              <div class="table-responsive" style="max-height: 320px; overflow: auto;">
                <table class="table table-sm table-striped align-middle mb-0">
                  <thead class="table-dark">
                    <tr>
                      <th *ngFor="let c of tableResp.columns" class="text-nowrap">
                        {{ c.name }}
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let r of tableResp.rows">
                      <td *ngFor="let c of tableResp.columns" class="text-nowrap">
                        {{ r[c.name] }}
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div *ngIf="tableResp.rows.length === 0" class="text-secondary small mt-2">
                No rows in this table.
              </div>
            </div>
          </div>

          <div class="small text-secondary mt-2">
            <i class="bi bi-sliders me-1"></i>
            DB mode is controlled by the server. UI always hits the same endpoints.
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
